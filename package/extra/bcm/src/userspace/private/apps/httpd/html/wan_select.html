<html>
   <head>
      <meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
      <link rel="stylesheet" href='stylemain.css' type='text/css'>
         <link rel="stylesheet" href='colors.css' type='text/css'>
            <script language="javascript" src="util.js"></script>
            <script language="javascript">

<!-- hide
var wan = <%ejGetOther(wan_select_data)%>;
var type = Object.keys(wan["rates"]);
var sessionKey='<%ejGetOther(sessionKey)%>';
var board = '<%ejGet(boardID)%>'
var selected_type='';
var current_type='';
var reboot=0;


function resetRequired() {
    var resetRequired = true;

    if ((selected_type.indexOf("None") != -1) || (current_type.indexOf("None") != -1)) {
        resetRequired = false;
    }
    if ((board.indexOf("6888") != -1) || (board.indexOf("6813") != -1)) {
        if ((selected_type.indexOf("GBE") != -1) || (current_type.indexOf("GBE") != -1)) { // switch to/from Active Ethernet 
           resetRequired = false;
        }
    }
    return resetRequired;
}

function loadXMLDoc(url) {
    var xmlhttp = new XMLHttpRequest();

    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == XMLHttpRequest.DONE) {
           if (xmlhttp.status == 200) {
               var res =  xmlhttp.responseText.split('/');
               if (res[0] != "0")
                   alert("Error setting configuration in NVRAM: " + res[0]);
               else {
                var r = resetRequired();
                if (r) {                    
                   var url = '/rebootinfo.cgi?sessionKey=' + res[1];
                   window.location = url;
               }
              }
           }
           else if (xmlhttp.status == 400) {
              alert('There was an error 400');
           }
           else {
               alert('something else other than 200 was returned');
           }
        }
    }
    var r =  resetRequired();
    url += "&reboot=" + Number(r);
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
}

function createOption(value, selected) {
    el = document.createElement('option');
    el.value = value;
    el.innerHTML = value;
    el.selected = selected;
    return el;
}

function create_rates(wan_selected) {
    rates = wan["rates"][wan_selected];
    if (!rates)
        rates = {};
    createOptions('rates', rates, wan.rate_selected);
}

function createOptions(where, list, selected) {
    var el = document.getElementById(where);
    el.innerHTML = '';
    var i = 0;
    for ( i = 0; i < list.length; i++ ) {
        el.appendChild(createOption(list[i], list[i] == selected));
    }
}

function frmLoad() {
    var el_types = document.getElementById('types');
    current_type = el_types.options[el_types.selectedIndex].value;

    function redraw_gbe() {
        var el_type = document.getElementById('types');
        var wan_selected = el_type.options[el_type.selectedIndex].value;
        create_rates(wan_selected);
    }
    function redraw() {
        var el_type = document.getElementById('types');
        var wan_selected = el_type.options[el_type.selectedIndex].value;
        selected_type = wan_selected
        create_rates(wan_selected);
    }
    document.getElementById('types').addEventListener('change', redraw);

    create_rates(wan.wan_selected);
}

function btnApply() {
   var loc = 'wan_select_cfg.cmd?';
   var r = resetRequired();

   with ( document.forms[0] ) {
       var idx = types.selectedIndex;
       loc += '&type=' + idx;
       var idx = rates.selectedIndex;
       loc += '&rate=' + idx;
       loc += '&reboot=' + Number(r);
   }
   loadXMLDoc(loc);
}

// done hiding -->
</script>
   </head>
   <body onLoad='frmLoad()'>
      <blockquote>
         <form>
            <b>WAN mode - Configuration<br>
            </b>
            <br>
            WAN mode for this device is saved in NVRAM.
            <br/>
            <br/>
            Select the desired mode and click "Apply/Save" to configure and reboot into the new mode.<br/>
            <br/>

            <table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td width=240>Type:</td>
	        <td><select id='types'>
	              <script language="javascript">
<!-- hide
{
   for ( var i = 0; i < type.length; i++ ) {
      if ( type[i] == wan['wan_selected'] )
         document.write("  <option value='" + type[i] + "' selected>");
      else
         document.write("  <option value='" + type[i] + "'>");
      document.writeln(type[i]);
   }
}
// done hiding -->
</script>
                      </select></td>
                 </tr>
                 <tr></tr>
            </table>
            <br>
            <table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td width=240>Rate:</td>
	        <td><select id='rates'>
                </select></td>
                 </tr>
                 <tr></tr>
            </table>

            <br>
            <p align="center">
               <input type='button' onClick='btnApply()' value='Apply/Save'>
            </P>
         </form>
      </blockquote>
   </body>
</html>
