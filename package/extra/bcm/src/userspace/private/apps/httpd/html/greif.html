<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
  <link rel="stylesheet" href="stylemain.css" type="text/css">
  <link rel="stylesheet" href="colors.css" type="text/css">
  <meta http-equiv="Pragma" content="no-cache">
  <title> GRE Settings</title>

  <script language="javascript" src="util.js"></script>
  <script language="javascript">

<!-- hide

var greTunnelId = '<%ejGet(greTunnelId)%>';
var greTunnelProto = '<%ejGet(greTunnelProto)%>';

var greTunnelIfLocalGwIf = '<%ejGet(greTunnelIfLocalGwIf)%>';
var greTunnelIfProtocol = '<%ejGet(greTunnelIfProtocol)%>';
var greTunnelIfUseCS = '<%ejGet(greTunnelIfUseCS)%>';
var greTunnelIfKeyPolicy = '<%ejGet(greTunnelIfKeyPolicy)%>';
var greTunnelIfKeyId = '<%ejGet(greTunnelIfKeyId)%>';
var greTunnelIfUseSN = '<%ejGet(greTunnelIfUseSN)%>';
var enblIP6 = '<%ejGetOther(sysInfo, enblIPv6)%>';

function showhide(element, sh)
{
    var status;
    if (sh == 1) {
        status = "block";
    }
    else {
        status = "none"
    }

    if (document.getElementById)
    {
        // standard
        document.getElementById(element).style.display = status;
    }
    else if (document.all)
    {
        // old IE
        document.all[element].style.display = status;
    }
    else if (document.layers)
    {
        // Netscape 4
        document.layers[element].display = status;
    }
}

function setSelect(item, value)
{
    for (i=0; i<item.options.length; i++) {
        if (item.options[i].value == value) {
            item.selectedIndex = i;
            break;
        }
    }
}

function submitText(item, name)
{
    return '&' + name + '=' + item.value;
}

function getSelect(item)
{
    var idx;
    if (item.options.length > 0) {
        idx = item.selectedIndex;
        return item.options[idx].value;
    }
    else {
        return '';
    }
}

function submitSelect(item, name)
{
    return '&' + name + '=' + getSelect(item);
}

function formLoad()
{
    with ( document.forms[0] ) {
        tunnelIfKeyIdentifier.value = greTunnelIfKeyId;
        tunnelIfProtocol.value = greTunnelIfProtocol;
        is_bridge.checked = true;
        enCheckSum.checked = false;
        enSN.checked = false;

        setSelect(tunnelIfKeyPolicy, greTunnelIfKeyPolicy);
        if ( getSelect(tunnelIfKeyPolicy) != 'Provisioned' )
            showhide('keyId', 0);
        else
            showhide('keyId', 1);

        if ( (greTunnelProto == 'IPv6') && (enblIP6 == '1') ) {
            showhide('gwv4', 0);
            showhide('gwv6', 1);
            setSelect(localGwV6, 'None');
        }
        else {
            showhide('gwv4', 1);
            showhide('gwv6', 0);
            setSelect(localGwV4, 'None');
        }
    }
}

function KeyGenSelect(OnPageLoad) {
    with ( document.forms[0] ) {
        if ( getSelect(tunnelIfKeyPolicy) != 'Provisioned' ) {
            showhide('keyId', 0);
            tunnelIfKeyIdentifier.value = greTunnelIfKeyId;
        }
        else
            showhide('keyId', 1);
    }
}

function applyClick() {
    var loc = 'gre.cmd?action=addIf';
    with ( document.forms[0] ) {
        if ( is_bridge.checked == true ) {
            if ( (greTunnelProto == 'IPv6') && (enblIP6 == '1') ) {
                if ( getSelect(localGwV6) == 'None' ) {
                    alert('Local Gateway Interface is invalid.');
                    return;
                }
            }
            else {
                if ( getSelect(localGwV4) == 'None' ) {
                    alert('Local Gateway Interface is invalid.');
                    return;
                }
            }
            loc += '&greTunnelIfL2Mode=1';
        }
        else
        {
            if ( (greTunnelProto == 'IPv6') && (enblIP6 == '1') ) {
                if ( getSelect(localGwV6) == 'None' ) {
                    alert('Local Gateway Interface is invalid.');
                    return;
                }
            }
            else {
                if ( getSelect(localGwV4) == 'None' ) {
                    alert('Local Gateway Interface is invalid.');
                    return;
                }
            }
            loc += '&greTunnelIfL2Mode=0';
        }

        if ( enCheckSum.checked == true ) {
            loc += '&greTunnelIfUseCS=1';
        }
        else {
            loc += '&greTunnelIfUseCS=0';
        }

        if ( enSN.checked == true ) {
            loc += '&greTunnelIfUseSN=1';
        }
        else {
            loc += '&greTunnelIfUseSN=0';
        }

        loc += '&greTunnelId=' + greTunnelId;
        loc += '&greTunnelProto=' + greTunnelProto;
        loc += submitText(tunnelIfKeyIdentifier, 'greTunnelIfKeyId');
        loc += submitText(tunnelIfProtocol, 'greTunnelIfProtocol');
        loc += submitText(tunnelIfKeyPolicy, 'greTunnelIfKeyPolicy');

        if ( (greTunnelProto == 'IPv6') && (enblIP6 == '1') )
            loc += submitSelect(localGwV6, 'greTunnelIfLocalGwIf');
        else
            loc += submitSelect(localGwV4, 'greTunnelIfLocalGwIf');

    }
    loc += '&sessionKey=<%ejGetOther(sessionKey)%>';
    var code = 'location="' + loc + '"';
    eval(code);
}

// done hiding -->
</script>

</head>

<body onLoad="formLoad()">
<blockquote>
<form>
  <b>GRE Tunnel Interface Settings</b>
  <table border="0" cellpadding="0" cellspacing="0">
    <tr>
     <td width='30' height="30"><input type='checkbox' name='is_bridge'></td>
     <td>L2 mode</td>
    </tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td></tr>
    <br>
    <tr>
     <td width='30' height="30"><input type='checkbox' name='enCheckSum'></td>
     <td>Enable Checksum</td>
    </tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td></tr>
    <br>
    <tr>
     <td width='30' height="30"><input type='checkbox' name='enSN'></td>
     <td>Enable Sequence Number</td>
    </tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td></tr>
    <br>
    <tr>
      <td width="40%">ProtocolId Override:</td>
      <td> <input name="tunnelIfProtocol" type="text"> </td>
    </tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td></tr>
    <br>
    <tr><script language="javascript">
    <!-- hide
    {
        document.writeln("<td width='40%'>Key Gen Policy:</td>");
        document.writeln("<td><select name='tunnelIfKeyPolicy' size='1' onChange='KeyGenSelect(1)'>");
        document.writeln("      <option value='Disabled'>Disabled");
        document.writeln("      <option value='Provisioned'>Provisioned");
        document.writeln("      <option value='CPE_Generated'>CPE_Generated");
        document.writeln("</select></td>")
    }
    // done hiding -->
    </script></tr>
  </table>

  <div id='keyId'>
  <br>
    <tr>
      <td width="40%">key id:</td>
      <td> <input name="tunnelIfKeyIdentifier" size="10" maxlength="20" type="text"> </td>
    </tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td></tr>
  </div>

  <br><br><br><br>
  <div id='gwv4'>
    <tr><script language="javascript">
    <!-- hide
    {
      var i;
      var intfInfo = '<%ejGetOther(wanInterfaceInfo, route)%>';
      var intf     = intfInfo.split('|');

      document.writeln("<td width='40%'>Local Gateway Interface:</td>");
      document.writeln("<td><select name='localGwV4'>");
      for ( i = 0; i < intf.length; i++ ) {
        var names = intf[i].split('/');
        if (names.length > 1) {
          document.write("  <option value='" + names[1] + "'>");
          document.writeln(intf[i]);
        }
      }
      document.write("  <option value='None'>");
      document.writeln("Select interface");
      document.writeln("    </select></td>");
    }
    // done hiding -->
    </script></tr>

  </div>

  <div id='gwv6'>
    <tr><script language="javascript">
    <!-- hide
    {
      var i;
      var intfInfo = '<%ejGetOther(wanInterfaceInfo, route6)%>';
      var intf     = intfInfo.split('|');

      document.writeln("<td width='40%'>Local Gateway Interface:</td>");
      document.writeln("<td><select name='localGwV6'>");
      for ( i = 0; i < intf.length; i++ ) {
        var names = intf[i].split('/');
        if (names.length > 1) {
          document.write("  <option value='" + names[1] + "'>");
          document.writeln(intf[i]);
        }
      }
      document.write("  <option value='None'>");
      document.writeln("Select interface");
      document.writeln("    </select></td>");
    }
    // done hiding -->
    </script>
    </tr>
  </div>

  <table border="0" cellpadding="0" cellspacing="2" width="100%">
      <tr><td></td><td>&nbsp;</td></tr>
      <tr>
        <td colspan="2" align="center">
          <input value="Apply/Save" type="button" onclick="applyClick();" >
        </td>
      </tr>
  </table>
</form>
</blockquote>
</body>
</html>
