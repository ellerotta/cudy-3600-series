#!/usr/bin/env perl

#
# DO NOT EDIT THIS FILE
#
# This file reads .config, makes changes, and writes it back
# if you need to make further changes, COPY this file to another
# executable file in the config.d directory with a .conf extension
# and replace the ACTIONS section with your own
#

use strict;
use warnings;
use BRCM::GenConfig;

my $g;
if (!@ARGV){
  print "\n Use the default configuration file. e.g. .config \n";
  $g = new BRCM::GenConfig('.config');
}else{
  $g = new BRCM::GenConfig($ARGV[0]);
}

my $extra_brcm_path="";
if ($ENV{BRCM_EXTRA_PATH} )
{
        $extra_brcm_path="$ENV{BRCM_EXTRA_PATH}"
}



# ACTIONS start here

$g->set( "CONFIG_PREFIX", qq["$ENV{INSTALL_DIR}/$extra_brcm_path/"] );

# Mainly for IKOS.arch
if( $ENV{BUILD_VANILLA_BUSYBOX_LITE} eq 'y' ) {
    $g->unset( "CONFIG_FEATURE_VERBOSE_USAGE");
    $g->unset( "CONFIG_FEATURE_FANCY_SLEEP");
    $g->unset( "CONFIG_STTY");
    $g->unset( "CONFIG_TTY");
    $g->unset( "CONFIG_GREP");
    $g->unset( "CONFIG_FEATURE_INIT_COREDUMPS");
    $g->unset( "CONFIG_DELUSER");
    $g->unset( "CONFIG_DMESG");
    $g->unset( "CONFIG_CHRT");
    $g->unset( "CONFIG_FLASH_ERASEALL");
    $g->unset( "CONFIG_FEATURE_IPV6");
    $g->unset( "CONFIG_FEATURE_PREFER_IPV4_ADDRESS");
    $g->unset( "CONFIG_FTPGET");
    $g->unset( "CONFIG_PING6");
    $g->unset( "CONFIG_TFTP");
    $g->unset( "CONFIG_TRACEROUTE");
    $g->unset( "CONFIG_FEATURE_TFTP_GET");
    $g->unset( "CONFIG_FEATURE_TFTP_PUT");
    $g->unset( "CONFIG_VCONFIG");
    $g->unset( "CONFIG_WGET");
    $g->unset( "CONFIG_SYSLOGD");
    $g->unset( "CONFIG_FEATURE_REMOTE_LOG");
    $g->unset( "CONFIG_FEATURE_SYSLOGD_DUP");
    $g->set( "CONFIG_FEATURE_SYSLOGD_READ_BUFFER_SIZE", 0);
    $g->unset( "CONFIG_FEATURE_IPC_SYSLOG");
    $g->set( "CONFIG_FEATURE_IPC_SYSLOG_BUFFER_SIZE, 0");
    $g->unset( "CONFIG_LOGREAD");
    $g->unset( "CONFIG_MD5SUM");
    $g->unset( "CONFIG_SHA256SUM");
    $g->unset( "CONFIG_MKNOD");
    $g->unset( "CONFIG_MKTEMP");
    $g->unset( "CONFIG_STAT");
    $g->unset( "CONFIG_SYNC");
    $g->unset( "CONFIG_WHICH");
    $g->unset( "CONFIG_AWK");
    $g->unset( "CONFIG_SED");
    $g->unset( "CONFIG_FIND");
    $g->unset( "CONFIG_HALT");
    $g->unset( "CONFIG_I2CGET");
    $g->unset( "CONFIG_I2CSET");
    $g->unset( "CONFIG_I2CDUMP");
    $g->unset( "CONFIG_I2CDETECT");
    $g->unset( "CONFIG_ARP");
    $g->unset( "CONFIG_ARPING");
    $g->unset( "CONFIG_IFCONFIG");
    $g->unset( "CONFIG_NC");
    $g->unset( "CONFIG_NETSTAT");
    $g->unset( "CONFIG_PING");
    $g->unset( "CONFIG_ROUTE");
    $g->unset( "CONFIG_TELNET");
    $g->unset( "CONFIG_TRACEROUTE");
    $g->unset( "CONFIG_UDHCPC");
    $g->unset( "CONFIG_FREE");
    $g->unset( "CONFIG_PWDX");
    $g->unset( "CONFIG_TOP");
    $g->unset( "CONFIG_GUNZIP");
    $g->unset( "CONFIG_RDEV");
    $g->unset( "CONFIG_BASENAME");
    $g->unset( "CONFIG_MODPROBE");
    $g->unset( "CONFIG_ADD_SHELL");
    $g->unset( "CONFIG_REMOVE_SHELL");
    $g->unset( "CONFIG_FATATTR");
    $g->unset( "ONFIG_FSTRIM");
    $g->unset( "CONFIG_SMEMCAP");
}

# Mainly for QEMU.arch
if ( $ENV{BRCM_QEMU} eq 'y' || $ENV{BRCM_IKOS} eq 'y') {
    if ( $ENV{BRCM_QEMU} eq 'y') {
        $g->set( "CONFIG_TELNETD",                     "y" );
        $g->set( "CONFIG_FEATURE_TELNETD_STANDALONE",  "y" );
    }

    if ( $ENV{BRCM_IKOS} eq 'y') {
        $g->unset( "CONFIG_GZIP");
        $g->unset( "CONFIG_NETMSG");
        $g->unset( "CONFIG_TAR");
        $g->unset( "CONFIG_USE_BB_CRYPT");
    }

    $g->unset( "CONFIG_MKTEMP");
    $g->unset( "CONFIG_FEATURE_AWK_LIBM");
    $g->unset( "CONFIG_VI");
    $g->unset( "CONFIG_FEATURE_VI_COLON");
    $g->unset( "CONFIG_FEATURE_VI_COLON_EXPAND");
    $g->unset( "CONFIG_FEATURE_VI_YANKMARK");
    $g->unset( "CONFIG_FEATURE_VI_SEARCH");
    $g->unset( "CONFIG_FEATURE_VI_USE_SIGNALS");
    $g->unset( "CONFIG_FEATURE_VI_DOT_CMD");
    $g->unset( "CONFIG_FEATURE_VI_READONLY");
    $g->unset( "CONFIG_FEATURE_VI_SETOPTS");
    $g->unset( "CONFIG_FEATURE_VI_SET");
    $g->unset( "CONFIG_FEATURE_VI_ASK_TERMINAL");
    $g->unset( "CONFIG_FEATURE_ALLOW_EXEC");
    $g->unset( "CONFIG_FIND");
    $g->unset( "CONFIG_FEATURE_FIND_PRINT0");
    $g->unset( "CONFIG_FEATURE_FIND_MTIME");
    $g->unset( "CONFIG_FEATURE_FIND_MMIN");
    $g->unset( "CONFIG_FEATURE_FIND_PERM");
    $g->unset( "CONFIG_FEATURE_FIND_TYPE");
    $g->unset( "CONFIG_FEATURE_FIND_EXECUTABLE");
    $g->unset( "CONFIG_FEATURE_FIND_XDEV");
    $g->unset( "CONFIG_FEATURE_FIND_MAXDEPTH");
    $g->unset( "CONFIG_FEATURE_FIND_NEWER");
    $g->unset( "CONFIG_FEATURE_FIND_INUM");
    $g->unset( "CONFIG_FEATURE_FIND_EXEC");
    $g->unset( "CONFIG_FEATURE_FIND_EXEC_PLUS");
    $g->unset( "CONFIG_FEATURE_FIND_USER");
    $g->unset( "CONFIG_FEATURE_FIND_GROUP");
    $g->unset( "CONFIG_FEATURE_FIND_NOT");
    $g->unset( "CONFIG_FEATURE_FIND_DEPTH");
    $g->unset( "CONFIG_FEATURE_FIND_PAREN");
    $g->unset( "CONFIG_FEATURE_FIND_SIZE");
    $g->unset( "CONFIG_FEATURE_FIND_PRUNE");
    $g->unset( "CONFIG_FEATURE_FIND_QUIT");
    $g->unset( "CONFIG_FEATURE_FIND_DELETE");
    $g->unset( "CONFIG_FEATURE_FIND_EMPTY");
    $g->unset( "CONFIG_FEATURE_FIND_PATH");
    $g->unset( "CONFIG_FEATURE_FIND_REGEX");
    $g->unset( "CONFIG_FEATURE_FIND_LINKS");
    $g->unset( "CONFIG_PIDOF");
}
# ACTIONS end here

$g->write();


