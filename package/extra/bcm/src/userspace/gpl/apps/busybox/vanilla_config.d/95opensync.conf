#!/usr/bin/env perl
use strict;
use warnings;
use BRCM::GenConfig;

my $g;
if (!@ARGV) {
    print "\n Use the default configuration file. e.g. .config \n";
    $g = new BRCM::GenConfig('.config');
}else{
    $g = new BRCM::GenConfig($ARGV[0]);
}

if ($ENV{BUILD_VANILLA_BUSYBOX_OPENSYNC} eq 'y') {
	$g->unset('CONFIG_FEATURE_EDITING_HISTORY');
	$g->set('CONFIG_FEATURE_EDITING_HISTORY', '50');

	$g->unset('CONFIG_FEATURE_VI_MAX_LEN');
	$g->set('CONFIG_FEATURE_VI_MAX_LEN', '4096');

	$g->unset('CONFIG_UDHCP_DEBUG');
	$g->set('CONFIG_UDHCP_DEBUG', '3');

	$g->set('CONFIG_DEFAULT_DEPMOD_FILE', '"modules.dep"'); # brcm.config sets this to "" causing modprobe to fail
	$g->set('CONFIG_LOGREAD', 'n'); # this is actually vendor/plume, TODO
	$g->set('CONFIG_LONG_OPTS', 'y');
	$g->set('CONFIG_FEATURE_SYSLOG', 'y');
	$g->set('CONFIG_LOGGER', 'y');
	$g->set('CONFIG_SYSLOGD', 'y');
	$g->set('CONFIG_FEATURE_EDITING_SAVEHISTORY', 'y');
	$g->set('CONFIG_FEATURE_EDITING_FANCY_PROMPT', 'y');
	$g->set('CONFIG_GUNZIP', 'y');
	$g->set('CONFIG_ZCAT', 'y');
	$g->set('CONFIG_BUNZIP2', 'y');
	$g->set('CONFIG_BZIP2', 'y');
	$g->set('CONFIG_FEATURE_BZIP2_DECOMPRESS', 'y');
	$g->set('CONFIG_GZIP', 'y');
	$g->set('CONFIG_FEATURE_GZIP_DECOMPRESS', 'y');
	$g->set('CONFIG_TAR', 'y');
	$g->set('CONFIG_FEATURE_TAR_LONG_OPTIONS', 'y');
	$g->set('CONFIG_FEATURE_TAR_CREATE', 'y');
	$g->set('CONFIG_FEATURE_TAR_FROM', 'y');
	$g->set('CONFIG_FEATURE_TAR_OLDGNU_COMPATIBILITY', 'y');
	$g->set('CONFIG_FEATURE_TAR_OLDSUN_COMPATIBILITY', 'y');
	$g->set('CONFIG_FEATURE_TAR_GNU_EXTENSIONS', 'y');
	$g->set('CONFIG_FEATURE_TAR_TO_COMMAND', 'y');
	$g->set('CONFIG_FEATURE_TAR_UNAME_GNAME', 'y');
	$g->set('CONFIG_FEATURE_TAR_NOPRESERVE_TIME', 'y');
	$g->set('CONFIG_BASENAME', 'y');
	$g->set('CONFIG_CHGRP', 'y');
	$g->set('CONFIG_CHOWN', 'y');
	$g->set('CONFIG_CUT', 'y');
	$g->set('CONFIG_DD', 'y');
	$g->set('CONFIG_DIRNAME', 'y');
	$g->set('CONFIG_ENV', 'y');
	$g->set('CONFIG_HEAD', 'y');
	$g->set('CONFIG_FEATURE_FANCY_HEAD', 'y');
	$g->set('CONFIG_MD5SUM', 'y');
	$g->set('CONFIG_FEATURE_MD5_SHA1_SUM_CHECK', 'y');
	$g->set('CONFIG_MKFIFO', 'y');
	$g->set('CONFIG_MKTEMP', 'y');
	$g->set('CONFIG_MV', 'y');
	$g->set('CONFIG_NOHUP', 'y');
	$g->set('CONFIG_PRINTENV', 'y');
	$g->set('CONFIG_READLINK', 'y');
	$g->set('CONFIG_FEATURE_READLINK_FOLLOW', 'y');
	$g->set('CONFIG_RMDIR', 'y');
	$g->set('CONFIG_SEQ', 'y');
	$g->set('CONFIG_FEATURE_FLOAT_SLEEP', 'y');
	$g->set('CONFIG_SORT', 'y');
	$g->set('CONFIG_STAT', 'y');
	$g->set('CONFIG_TAC', 'y');
	$g->set('CONFIG_TAIL', 'y');
	$g->set('CONFIG_FEATURE_FANCY_TAIL', 'y');
	$g->set('CONFIG_TEE', 'y');
	$g->set('CONFIG_TIMEOUT', 'y');
	$g->set('CONFIG_TOUCH', 'y');
	$g->set('CONFIG_FEATURE_TOUCH_NODEREF', 'y');
	$g->set('CONFIG_FEATURE_TOUCH_SUSV3', 'y');
	$g->set('CONFIG_TR', 'y');
	$g->set('CONFIG_BASE64', 'y');
	$g->set('CONFIG_WC', 'y');
	$g->set('CONFIG_YES', 'y');
	$g->set('CONFIG_RESIZE', 'y');
	$g->set('CONFIG_FEATURE_RESIZE_PRINT', 'y');
	$g->set('CONFIG_START_STOP_DAEMON', 'y');
	$g->set('CONFIG_WHICH', 'y');
	$g->set('CONFIG_AWK', 'y');
	$g->set('CONFIG_CMP', 'y');
	$g->set('CONFIG_DIFF', 'y');
	$g->set('CONFIG_PATCH', 'y');
	$g->set('CONFIG_SED', 'y');
	$g->set('CONFIG_VI', 'y');
	$g->set('CONFIG_FEATURE_VI_WIN_RESIZE', 'y');
	$g->set('CONFIG_FIND', 'y');
	$g->set('CONFIG_FEATURE_FIND_PRINT0', 'y');
	$g->set('CONFIG_FEATURE_FIND_TYPE', 'y');
	$g->set('CONFIG_FEATURE_FIND_EXEC', 'y');
	$g->set('CONFIG_FEATURE_FIND_NOT', 'y');
	$g->set('CONFIG_FEATURE_FIND_EMPTY', 'y');
	$g->set('CONFIG_EGREP', 'y');
	$g->set('CONFIG_XARGS', 'y');
	$g->set('CONFIG_LINUXRC', 'y');
	$g->set('CONFIG_ADDUSER', 'y');
	$g->set('CONFIG_CHPASSWD', 'y');
	$g->set('CONFIG_PASSWD', 'y');
	$g->set('CONFIG_LSMOD', 'y');
	$g->set('CONFIG_MODINFO', 'y');
	$g->set('CONFIG_FEATURE_DMESG_PRETTY', 'y');
	$g->set('CONFIG_FLOCK', 'y');
	$g->set('CONFIG_HEXDUMP', 'y');
	$g->set('CONFIG_LOSETUP', 'y');
	$g->set('CONFIG_LSPCI', 'y');
	$g->set('CONFIG_MKSWAP', 'y');
	$g->set('CONFIG_FEATURE_MOUNT_FLAGS', 'y');
	$g->set('CONFIG_FEATURE_MOUNT_FSTAB', 'y');
	$g->set('CONFIG_MOUNTPOINT', 'y');
	$g->set('CONFIG_PIVOT_ROOT', 'y');
	$g->set('CONFIG_FEATURE_MOUNT_LOOP', 'y');
	$g->set('CONFIG_FEATURE_MOUNT_LOOP_CREATE', 'y');
	$g->set('CONFIG_DEVMEM', 'y');
	$g->set('CONFIG_FLASH_ERASEALL', 'y');
	$g->set('CONFIG_FLASH_LOCK', 'y');
	$g->set('CONFIG_FLASH_UNLOCK', 'y');
	$g->set('CONFIG_RX', 'y');
	$g->set('CONFIG_STRINGS', 'y');
	$g->set('CONFIG_IFUP', 'y');
	$g->set('CONFIG_IFDOWN', 'y');
	$g->set('CONFIG_FEATURE_IFUPDOWN_IP', 'y');
	$g->set('CONFIG_IP', 'y');
	$g->set('CONFIG_IPADDR', 'y');
	$g->set('CONFIG_IPLINK', 'y');
	$g->set('CONFIG_IPROUTE', 'y');
	$g->set('CONFIG_NSLOOKUP', 'y');
	$g->set('CONFIG_FEATURE_IP_ADDRESS', 'y');
	$g->set('CONFIG_FEATURE_IP_LINK', 'y');
	$g->set('CONFIG_FEATURE_IP_ROUTE', 'y');
	$g->set('CONFIG_TELNETD', 'y');
	$g->set('CONFIG_FEATURE_TELNETD_STANDALONE', 'y');
	$g->set('CONFIG_FEATURE_TELNETD_INETD_WAIT', 'y');
	$g->set('CONFIG_UDHCPC', 'y');
	$g->set('CONFIG_LSOF', 'y');
	$g->set('CONFIG_MPSTAT', 'y');
	$g->set('CONFIG_PGREP', 'y');
	$g->set('CONFIG_PKILL', 'y');
	$g->set('CONFIG_PIDOF', 'y');
	$g->set('CONFIG_PMAP', 'y');
	$g->set('CONFIG_UPTIME', 'y');
	$g->set('CONFIG_WATCH', 'y');
	$g->set('CONFIG_ASH_JOB_CONTROL', 'y');
	$g->set('CONFIG_ASH_EXPAND_PRMT', 'y');
	$g->set('CONFIG_ASH_GETOPTS', 'y');
	$g->set('CONFIG_FEATURE_ROTATE_LOGFILE', 'y');
	$g->set('CONFIG_FEATURE_SYSLOGD_READ_BUFFER_SIZE', '512');
	$g->set('CONFIG_LESS', 'y');
	$g->set('CONFIG_FEATURE_LESS_MAXLINES', 9999999);
	$g->set('CONFIG_FEATURE_LESS_REGEXP', 'y');
	$g->set('CONFIG_FEATURE_LESS_WINCH', 'y');
	$g->set('CONFIG_FEATURE_LESS_ASK_TERMINAL', 'y');
	$g->set('CONFIG_FTPGET', 'n');
	$g->set('CONFIG_NANDDUMP', 'n');
}

$g->write();
