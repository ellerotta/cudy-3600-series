--- ori_miniupnpd-2.3.3/configure	2022-10-22 05:10:27.000000000 +0800
+++ miniupnpd-2.3.3/configure	2023-03-01 15:42:34.572462492 +0800
@@ -506,32 +506,6 @@
 		echo "# generated by $0 on `date`" > config.mk
 		echo "SRCDIR = ${BASEDIR}" >> config.mk
 		echo "CPPFLAGS += -I." >> config.mk
-		if [ "$PKG_CONFIG" ] ; then
-			if ${PKG_CONFIG} --exists libiptc ; then
-				IPTABLESVERSION=`${PKG_CONFIG} --modversion libiptc`
-				echo "detected libiptc version $IPTABLESVERSION"
-				echo "# detected libiptc version $IPTABLESVERSION" >> config.mk
-				echo "IPTABLES_PCFILE_FOUND = 1" >> config.mk
-				IPTVER1=`echo $IPTABLESVERSION | cut -d. -f1`
-				IPTVER2=`echo $IPTABLESVERSION | cut -d. -f2`
-				IPTVER3=`echo $IPTABLESVERSION | cut -d. -f3`
-				if [ $IPTVER1 -gt 1 ] || \
-				   [ \( $IPTVER1 -eq 1 \) -a \( \( $IPTVER2 -gt 4 \) \
-				     -o \( \( $IPTVER2 -eq 4 \) -a \( $IPTVER3 -ge 3 \) \) \) ] ; then
-					IPTABLES_143=1
-				fi
-				echo "CFLAGS += `${PKG_CONFIG} --cflags libiptc`" >> config.mk
-				echo "LDLIBS += `${PKG_CONFIG} --static --libs-only-l libiptc`" >> config.mk
-				echo "LDFLAGS += `${PKG_CONFIG} --libs-only-L --libs-only-other libiptc`" >> config.mk
-			else
-				echo "Warning: no libiptc pkg-config found"
-			fi
-			if ${PKG_CONFIG} --atleast-version=1.0.2 libnetfilter_conntrack \
-			   && ${PKG_CONFIG} --atleast-version=1.0.3 libmnl ; then
-				echo "CPPFLAGS += -DUSE_NFCT" >> config.mk
-				echo "LDLIBS += `${PKG_CONFIG} --static --libs-only-l libmnl libnetfilter_conntrack`" >> config.mk
-			fi
-		fi
 		if [ "$IPTABLESPATH" ] ; then
 			echo "CPPFLAGS += -I${IPTABLESPATH}/include/" >> config.mk
 			echo "LDFLAGS += -L${IPTABLESPATH}/libiptc/" >> config.mk
@@ -604,25 +578,6 @@
 		;;
 esac
 
-if [ "$FW" = "iptables" ] || [ "$FW" = "nftables" ] ; then
-	# linux
-	if [ "$PKG_CONFIG" ] ; then
-		if ${PKG_CONFIG} --exists libcap-ng ; then
-			echo "detected libcap-ng `${PKG_CONFIG} --modversion libcap-ng`"
-			echo "CFLAGS += `${PKG_CONFIG} --cflags libcap-ng`" >> config.mk
-			echo "LDLIBS += `${PKG_CONFIG} --libs-only-l libcap-ng`" >> config.mk
-			echo "LDFLAGS += `${PKG_CONFIG} --libs-only-L --libs-only-other libcap-ng`" >> config.mk
-			echo "#define HAS_LIBCAP_NG" >> ${CONFIGFILE}
-		elif ${PKG_CONFIG} --exists libcap ; then
-			echo "detected libcap `${PKG_CONFIG} --modversion libcap`"
-			echo "CFLAGS += `${PKG_CONFIG} --cflags libcap`" >> config.mk
-			echo "LDLIBS += `${PKG_CONFIG} --libs-only-l libcap`" >> config.mk
-			echo "LDFLAGS += `${PKG_CONFIG} --libs-only-L --libs-only-other libcap`" >> config.mk
-			echo "#define HAS_LIBCAP" >> ${CONFIGFILE}
-		fi
-	fi
-fi
-
 if [ "$MAKEFILE" = "Makefile.bsd" ] || [ "$OS_NAME" = "Darwin" ] || [ "$OS_NAME" = "SunOS" ] ; then
 	echo "FWNAME = $FW" > bsdmake.inc
 	echo "SRCDIR = ${BASEDIR}" >> bsdmake.inc
@@ -633,19 +588,8 @@
 fi
 
 # UUID API
-case $OS_NAME in
-	OpenWrt)
-		echo "#define LIB_UUID" >> ${CONFIGFILE}
-		;;
-	*)
-		if grep uuid_create /usr/include/uuid.h > /dev/null 2>&1 ; then
-			echo "#define BSD_UUID" >> ${CONFIGFILE}
-		fi
-		if grep uuid_generate /usr/include/uuid/uuid.h > /dev/null 2>&1 ; then
-			echo "#define LIB_UUID" >> ${CONFIGFILE}
-		fi
-		;;
-esac
+
+echo "#define LIB_UUID" >> ${CONFIGFILE}
 
 # set V6SOCKETS_ARE_V6ONLY to 0 if it was not set above
 if [ -z "$V6SOCKETS_ARE_V6ONLY" ] ; then


--- ori_miniupnpd-2.3.3/Makefile.linux	2022-01-23 08:17:38.000000000 +0800
+++ miniupnpd-2.3.3/Makefile.linux	2023-03-01 15:44:06.680465549 +0800
@@ -84,16 +84,6 @@
 #LDLIBS += -lnfnetlink
 
 # OpenWrt packager disables https server for IGD v2 and hardcodes libuuid support
-ifeq ($(TARGET_OPENWRT),)
-LDLIBS += $(shell $(PKG_CONFIG) --static --libs-only-l libssl)
-
-TEST := $(shell $(PKG_CONFIG) --exists uuid && echo 1)
-ifeq ($(TEST),1)
-LDLIBS += $(shell $(PKG_CONFIG) --static --libs-only-l uuid)
-else
-$(info please install uuid-dev package / libuuid)
-endif # ($(TEST),1)
-endif # ($(TARGET_OPENWRT,)
 
 ifneq ($(shell ldd --version | grep GLIBC),)
 GLIBC_VERSION := $(shell ldd --version | head -n 1 | sed 's/^.* //')
@@ -105,6 +95,8 @@
   then echo "-lrt" ; fi )
 endif
 
+LDLIBS += -lssl -ldl -lcrypto -ldl -luuid 
+
 TESTUPNPDESCGENOBJS = testupnpdescgen.o upnpdescgen.o
 
 EXECUTABLES = miniupnpd testupnpdescgen testgetifstats \
